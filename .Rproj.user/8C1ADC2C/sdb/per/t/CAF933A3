{
    "contents" : "---\ntitle: \"Weather events wich resulted in most population health and econimic damage\"\nauthor: \"Alexandr Cherkashin\"\ndate: \"Wednesday, January 23, 2015\"\noutput: html_document\n---\n\n##Synopsis\nThis project will address some basic questions about severe weather events:\n       \n        - Across the United States, which types of events are most harmful with respect to population health?\n        - Across the United States, which types of events have the greatest economic consequences?\n\nThis project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage. The events in the database start in the year 1950 and end in November 2011.\n\nWe will find that such events like **tornadoes**, **hurricanes**, **heat** and **floods** are most harmfull to population health.\nFor economic most severe events are **floods**, **hurricanes**, **tornadoes** and **drought**.\n\n##Data Processing\n###Used r packages\nFor further analisys and data transformations will use several r packages. \nCheck that needed packages had been installed and install them if not:\n```{r, message=FALSE}\nlist.of.packages <- c(\"ggplot2\", \"dplyr\", \"tidyr\", \"scales\")\nnew.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,\"Package\"])]\nif(length(new.packages)) install.packages(new.packages)\nsapply(list.of.packages, require, quietly = TRUE, character.only = TRUE)\n\n#remove unused variables\nrm(list.of.packages)\nrm(new.packages)\n```\n\n###Data source\nThe data for this project come in the form of a comma-separated-value file compressed via the bzip2 algorithm to reduce its size. It comes from course web site by this link: http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2\n\nDownload data unless it's already done:\n```{r}\nif (!file.exists(\"./data\")) {dir.create(\"./data\")}\nif (!file.exists(\"./data/StormData.bz2\")) {download.file(\"http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2\", \"./data/StormData.bz2\", mode = \"wb\")}\n```\n\n###Data preparation\nExtract and read the data:\n```{r, cache=TRUE}\ncon <- bzfile(\"./data/StormData.bz2\", open=\"r\")\ndata <- read.csv(con)\nclose(con)\nrm(con)\n```\n\nLook at column names:\n```{r}\ncolnames(data)\n```\n\nFor the purpose of this project we need only some, so get rid of others to make dataset smaller.\n```{r, cache=TRUE}\ndata <- select(data, EVTYPE, 23:28)\n```\n\nAccording to [Storm Data Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf) section 2.7:\n\n>Estimates should be rounded to three significant digits, followed by an alphabetical character signifying the magnitude of the number, i.e., 1.55B for $1,550,000,000.  Alphabetical characters used to signify magnitude include вЂњKвЂќ for thousands, вЂњMвЂќ for >millions, and вЂњBвЂќ for billions.\n<...>\n>If the dollar amount of damage is unknown, or not available, check the вЂњno information availableвЂќ box.\n\nLets look at unique values of PROPDMGEXP and CROPDMGEXP colums that contains these magnitude signifyers:\n```{r}\ntable(data[data$PROPDMG!=0, \"PROPDMGEXP\"])\ntable(data[data$CROPDMG!=0, \"CROPDMGEXP\"])\n```\n\nFor this analisys we'll assume that lower case characters means that capital ones do.\nAs we can see, there are several signifyers of unkown type like \"h\" or \"?\" but they have very small accurance when the corresponding DMG colums is not equal zero. There could be different theories but we will not do any bold assumtions. Accrording to such a small occurance We will map such values to zero and then multiply damage columns by it (drop damage values). We will use summary (not mean) aggregation later, occurance is small, so it is ok for now.\n\n```{r}\n#make all chars same size\ndata$PROPDMGEXP <- tolower(as.character(data$PROPDMGEXP))\ndata$CROPDMGEXP <- tolower(as.character(data$CROPDMGEXP))\n\n#making multiplyer\ndata$PROPDMGEXP[data$PROPDMGEXP!=\"b\" & data$PROPDMGEXP!=\"m\" & data$PROPDMGEXP!=\"k\"] <- 0\ndata$PROPDMGEXP[data$PROPDMGEXP==\"b\"] <- 1000000000\ndata$PROPDMGEXP[data$PROPDMGEXP==\"m\"] <- 1000000\ndata$PROPDMGEXP[data$PROPDMGEXP==\"k\"] <- 1000\n\ndata$CROPDMGEXP[data$CROPDMGEXP!=\"b\" & data$CROPDMGEXP!=\"m\" & data$CROPDMGEXP!=\"k\"] <- 0\ndata$CROPDMGEXP[data$CROPDMGEXP==\"b\"] <- 1000000000\ndata$CROPDMGEXP[data$CROPDMGEXP==\"m\"] <- 1000000\ndata$CROPDMGEXP[data$CROPDMGEXP==\"k\"] <- 1000\n\n#Multiply DMG columns\ndata$PROPDMG <- data$PROPDMG * as.numeric(data$PROPDMGEXP)\ndata$CROPDMG <- data$CROPDMG * as.numeric(data$CROPDMGEXP)\ndata <- select(data, EVTYPE, FATALITIES, INJURIES, PROPDMG, CROPDMG)\n```\n\nThere are 985 levels of EVTYPE factor. We will try to reduce the number of unique values\n```{r}\ndata <- filter(data, !grepl(\"Summary\", EVTYPE, ignore.case = TRUE))\ndata$EVTYPE <- toupper(as.character(data$EVTYPE))\ndata[grep(\"heat\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heat\"\ndata[grep(\"warm\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heat\"\ndata[grep(\"hot\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heat\"\ndata[grep(\"HIGH TEMPER\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heat\"\ndata[grep(\"HYPERTHERMIA\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heat\"\ndata[grep(\"Record High\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heat\"\n\ndata[grep(\"cold\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"cool\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"frost\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"HYPORTHERMIA\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"freez\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"frost\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"ice\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"icy\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"LOW TEMPER\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\ndata[grep(\"RECORD LOW\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Cold\"\n\ndata[grep(\"tornado\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Tornado\"\ndata[grep(\"spout\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Tornado\"\n\ndata[grep(\"swell\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High swells\"\ndata[grep(\"surf\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High swells\"\ndata[grep(\"wave\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High swells\"\ndata[grep(\"ROUGH SEAS\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High swells\"\n\ndata[grep(\"wind\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High wind/hurricane\"\ndata[grep(\"hurricane\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High wind/hurricane\"\ndata[grep(\"wnd\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High wind/hurricane\"\ndata[grep(\"TYPHOON\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High wind/hurricane\"\ndata[grep(\"tsunami\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High wind/hurricane\"\ndata[grep(\"storm\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"High wind/hurricane\"\n\ndata[grep(\"snow\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heavy snow\"\ndata[grep(\"blizz\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heavy snow\"\ndata[grep(\"wint\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heavy snow\"\n\ndata[grep(\"flood\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Flood\"\ndata[grep(\"FLD\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Flood\"\ndata[grep(\"water\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Flood\"\ndata[grep(\"stream\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Flood\"\ndata[grep(\"tide\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Flood\"\n\ndata[grep(\"rain\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heavy rain\"\ndata[grep(\"SHOWER\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heavy rain\"\ndata[grep(\"precipit\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Heavy rain\"\n\ndata[grep(\"dry\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Drought\"\ndata[grep(\"drought\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Drought\"\n\ndata[grep(\"hail\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Hail\"\n\ndata[grep(\"fog\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Fog\"\n\ndata[grep(\"wet\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Wet\"\n\ndata[grep(\"fire\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Wildfire\"\n\ndata[grep(\"light\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Lightning\"\n\ndata[grep(\"rip\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Rip current\"\n\ndata[grep(\"avalanc\", data$EVTYPE, ignore.case = TRUE), \"EVTYPE\"] <- \"Avalanche\"\n```\n\nAll other values that a still in upper case we'll map to \"Other\" category. Then group all types together.\n```{r}\ndata$EVTYPE[data$EVTYPE == toupper(data$EVTYPE)] <- \"Other\"\n```\n\nGroup data and make columns with total harm mostly for ordering purposes:\n```{r}\ndata$EVTYPE <- factor(data$EVTYPE)\ndata <- group_by(data, EVTYPE) %>% summarise_each(funs(sum))\nHdata <- select(mutate(data, TOTALDMG = INJURIES + FATALITIES), EVTYPE, TOTALDMG, INJURIES, FATALITIES)\nEdata <- select(mutate(data, TOTALDMG = PROPDMG + CROPDMG), EVTYPE, TOTALDMG, PROPDMG, CROPDMG)\nrm(data)\nEdata <- arrange(Edata, desc(TOTALDMG))\nHdata <- arrange(Hdata, desc(TOTALDMG))\n```\n\n##Results\n###Across the United States, which types of events are most harmful with respect to population health?\n```{r, fig.width=9}\np <- ggplot(Hdata, aes(x = EVTYPE)) +\n        geom_bar(aes(y = TOTALDMG, fill = \"grey95\"), stat=\"identity\", colour = \"grey\") +\n        geom_point(aes(y = INJURIES, colour = \"orange\"), alpha = 0.7, shape = 19, size = 4) +\n        geom_point(aes(y = FATALITIES, colour = \"red\"), alpha = 0.7, shape = 19, size = 4) +\n        scale_fill_identity(name = 'Bar', guide = 'legend',labels = c('Total damaged\\npeople')) +\n        scale_colour_manual(name = 'Points', \n                            values =c('orange'='orange','red'='red'), labels = c('Injuries','Fatalities')) +\n        scale_x_discrete(limits = rev(Hdata$EVTYPE)) +\n        scale_y_continuous(labels = comma, breaks = seq(0, 100000, 20000)) +\n        ylab(\"Count in units\") + xlab(\"Event type\") +\n        ggtitle(\"Total population health damage for 1950 - 2011\") +\n        theme_bw() + coord_flip()\nprint(p)\n```\n\nMost damage to population health was done by **tornadoes**, **hurricanes**, **heat** and **floods**. Heat comes in second place if we'll count fatalities.\n\n###Across the United States, which types of events have the greatest economic consequences? \n```{r, fig.width=9}\np <- ggplot(Edata, aes(x = EVTYPE)) +\n        geom_bar(aes(y = TOTALDMG/1000000, fill = \"grey95\"), stat=\"identity\", colour = \"grey\") +\n        geom_point(aes(y = PROPDMG/1000000, colour = \"blue\"), alpha = 0.7, shape = 19, size = 4) +\n        geom_point(aes(y = CROPDMG/1000000, colour = \"brown\"), alpha = 0.7, shape = 19, size = 4) +\n        scale_fill_identity(name = 'Bar', guide = 'legend',labels = c('Total damage')) +\n        scale_colour_manual(name = 'Points', \n                            values =c('blue'='blue','brown'='brown'), labels = c('Property damage','Crop damage')) +\n        scale_x_discrete(limits = rev(Edata$EVTYPE)) +\n        scale_y_continuous(labels = dollar, breaks = seq(0, 175000, 25000)) +\n        ylab(\"Millions of dollars\") + xlab(\"Event type\") +\n        ggtitle(\"Total economics damage for 1950 - 2011\") +\n        theme_bw() + coord_flip()\nprint(p)\n```\n\nThe to leaders are **floods** and **hurricanes**. If we are talking about crop, **drought** and **cold** did lots of harm too.",
    "created" : 1424334613504.000,
    "dirty" : false,
    "encoding" : "CP1251",
    "folds" : "",
    "hash" : "1694985854",
    "id" : "CAF933A3",
    "lastKnownWriteTime" : 1422021864,
    "path" : "~/DataScience/RR/RepData_PeerAssessment2/WeatherDisasterAnalisys.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}